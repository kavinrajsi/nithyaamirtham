{% schema %}
{
  "name": "Legacy Brand Story",
  "settings": [
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "TASTE THE LEGACY TODAY!"
    },
    {
      "type": "textarea",
      "id": "description",
      "label": "Description",
      "default": "Since 1948, our Indian brand has been delighting customers with an exquisite mithai, spice powders, namkeens, and tangy pickles."
    },
    {
      "type": "range",
      "id": "columns",
      "min": 1,
      "max": 6,
      "step": 1,
      "label": "Number of Columns",
      "default": 5
    },
    {
      "type": "paragraph",
      "content": "Add up to 6 videos or images"
    }
  ],
  "blocks": [
    {
      "type": "media",
      "name": "Media Item",
      "settings": [
        {
          "type": "video",
          "id": "shopify_video",
          "label": "Shopify Video"
        },
        {
          "type": "video_url",
          "id": "video_link",
          "label": "Video link",
          "accept": [
            "youtube",
            "vimeo"
          ],
          "default": "https://www.youtube.com/watch?v=_9VUPq3SxOc",
          "info": "Accepts YouTube or Vimeo links"
        },
        {
          "type": "image_picker",
          "id": "fallback_image",
          "label": "Fallback Image"
        },
        {
          "type": "text",
          "id": "alt_text",
          "label": "Alternative Text",
          "default": "Brand Story Image"
        }
      ]
    }
  ],
  "max_blocks": 6,
  "presets": [
    {
      "name": "Legacy Brand Story",
      "blocks": [
        {
          "type": "media"
        },
        {
          "type": "media"
        },
        {
          "type": "media"
        },
        {
          "type": "media"
        },
        {
          "type": "media"
        }
      ]
    }
  ]
}
{% endschema %}

<div class="legacy-brand-story container mx-auto px-4 py-16">
  <div class="text-center mb-12">
    <h2 class="text-3xl font-bold mb-4">{{ section.settings.heading }}</h2>
    <p class="text-lg text-gray-600 max-w-2xl mx-auto">
      {{ section.settings.description }}
    </p>
  </div>

  {% assign columns = section.settings.columns | default: 5 %}
  <div class="grid grid-cols-{{ columns }} gap-4">
    {% for block in section.blocks %}
      {% if block.type == 'media' %}
        <div class="legacy-media relative overflow-hidden rounded-lg shadow-md">
          {% assign video_source = null %}

          {% if block.settings.shopify_video %}
            {% assign video_source = block.settings.shopify_video %}
          {% elsif block.settings.video_link %}
            {% assign video_source = block.settings.video_link %}
          {% endif %}

          {% if video_source %}
            <video
              class="w-full h-full object-cover"
              playsinline
              autoplay
              muted
              loop
              preload="auto"
              poster="{{ block.settings.fallback_image | img_url: '400x' }}"
              aria-label="{{ block.settings.alt_text }}"
            >
              {% if block.settings.shopify_video %}
                {% for source in video_source.sources %}
                  <source src="{{ source.url }}" type="{{ source.mime_type }}">
                {% endfor %}
              {% else %}
                <source src="{{ video_source | video_url }}" type="video/mp4">
              {% endif %}

              {% if block.settings.fallback_image %}
                <img
                  src="{{ block.settings.fallback_image | img_url: '400x' }}"
                  alt="{{ block.settings.alt_text }}"
                  class="w-full h-full object-cover"
                >
              {% endif %}

              Your browser does not support the video tag.
            </video>
          {% elsif block.settings.fallback_image %}
            {{ block.settings.fallback_image | image_url: width: 400 | image_tag:
              class: 'w-full h-full object-cover',
              alt: block.settings.alt_text
            }}
          {% endif %}
        </div>
      {% endif %}
    {% endfor %}
  </div>
</div>

<style>
  .legacy-media video {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }
</style>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const videos = document.querySelectorAll('.legacy-media video');
    videos.forEach(video => {
      video.muted = true;
      video.autoplay = true;
      video.playsInline = true;
      video.loop = true;

      // Ensure video starts playing
      video.play().catch(error => {
        console.log('Autoplay was prevented:', error);
      });
    });
  });
</script>
